<!DOCTYPE html>

<html>
	<head>
		<title>Data Sense</title>
		<!--<meta charset="utf-8" />-->
		<meta name="google-signin-client_id" content="798265448710-nqo7h881abf59cn9oghng9erq841tbq1.apps.googleusercontent.com">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<script src="https://apis.google.com/js/platform.js" async defer></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<script type=text/javascript>
			
			// Used to sign in to Google Profile
			function onSignIn(googleUser) {
				var profile = googleUser.getBasicProfile();
				$(".g-signin2").css("display","none");
				$(".data").css("display","block");
				$("#pic").attr('src',profile.getImageUrl());
				$("#email").text(profile.getEmail());
				$('#name').text(profile.getName());
			}
			
			
			// Used to sign out of profile
			function signOut() {
				var auth2 = gapi.auth2.getAuthInstance();
				auth2.signOut().then(function() {
					if (confirm('Are you sure you want to sign out?')) {
						$(".g-signin2").css("display","block");
						$(".data").css("display","none");
					} else {
						// Does nothing
					}
				})
			}

			var input = document.querySelector('input');
			var preview = document.querySelector('.preview');

			input.style.opacity = 0;input.addEventListener('change', updateImageDisplay);function updateImageDisplay() {
			while(preview.firstChild) {
				preview.removeChild(preview.firstChild);
			}

			var curFiles = input.files;
			if(curFiles.length === 0) {
				var para = document.createElement('p');
				para.textContent = 'No files currently selected for upload';
				preview.appendChild(para);
			} else {
				var list = document.createElement('ol');
				preview.appendChild(list);
				for(var i = 0; i < curFiles.length; i++) {
				var listItem = document.createElement('li');
				var para = document.createElement('p');
				if(validFileType(curFiles[i])) {
					para.textContent = 'File name ' + curFiles[i].name + ', file size ' + returnFileSize(curFiles[i].size) + '.';
					var file = document.createElement('img');
					image.src = window.URL.createObjectURL(curFiles[i]);

					listItem.appendChild(file);
					listItem.appendChild(para);

				} else {
					para.textContent = 'File name ' + curFiles[i].name + ': Not a valid file type. Update your selection.';
					listItem.appendChild(para);
				}

				list.appendChild(listItem);
				}
			}
			}var fileTypes = [
			'file/xlsx',
			'file/csv'
			]

			function validFileType(file) {
			for(var i = 0; i < fileTypes.length; i++) {
				if(file.type === fileTypes[i]) {
				return true;
				}
			}

			return false;
			}function returnFileSize(number) {
			if(number < 1024) {
				return number + 'bytes';
			} else if(number >= 1024 && number < 1048576) {
				return (number/1024).toFixed(1) + 'KB';
			} else if(number >= 1048576) {
				return (number/1048576).toFixed(1) + 'MB';
			}	
			}
		</script>
		<style>
			.g-signin2 {
				position: fixed;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%);
			}
			.data {
				display: none;
			}
            body {
                padding-top: 70px;
                padding-left: 5px;
			}

            ul.nav li.dropdown:hover ul.dropdown-menu {
                display: block;
            }
		</style>
	</head>

    <body style="background-image:url('what-the-hex.png');">
        <nav class="navbar navbar-fixed-top admin-menu" role="navigation">
            <a class="navbar-brand" href="/">Data Sense</a>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <a class="nav-item nav-link" href="/about.html">About</a>
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1" style="padding-right:15px;">
                <ul class="nav navbar-nav navbar-right">
                    <li class="dropdown">
                        <img id="pic" class="img-circle data" width="35" height="35" />
                        <ul class="dropdown-menu">
                            <li>
                                <a href="/profile.html">Profile Settings</a>
                            </li>
                            <li>
                                <button onclick="signOut()" class="btn btn-primary" style="padding-right:5px;">Sign Out</button>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </nav>

        <div class="g-signin2" data-onsuccess="onSignIn"></div>
        <div class="data">
			<p id="name"></p>
			<form method="post" enctype="multipart/form-data">
				<div>
				  	<label for="file_uploads">Choose file to upload (.xlsx | .csv)</label>
				  	<input type="file" id="file_uploads" name="file_uploads" accept=".xlsx, .csv" multiple>
				</div>
				<div class="preview">
				  	<p>No files currently selected for upload</p>
				</div>
				<div>
				  	<button>Submit</button>
				</div>
			</form>
            <h3>Here are your files</h3>
            {% for key, value in result.items() %}
            <p> {{ value }} </p>
            {% endfor %}
            <h3>End</h3>
        </div>
    </body>
</html>