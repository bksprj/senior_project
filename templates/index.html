<!DOCTYPE html>

<html>
	<head>
		<title>Data Sense</title>
		<!--<meta charset="utf-8" />-->
		<meta name="google-signin-client_id" content="798265448710-nqo7h881abf59cn9oghng9erq841tbq1.apps.googleusercontent.com">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<script src="https://apis.google.com/js/platform.js" async defer></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<script type=text/javascript>
			
			// Used to sign in to Google Profile
			function onSignIn(googleUser) {
				var profile = googleUser.getBasicProfile();
				$(".g-signin2").css("display","none");
				$(".data").css("display","block");
				$("#pic").attr('src',profile.getImageUrl());
				$("#email").text(profile.getEmail());
				$('#name').text(profile.getName());
			}
			
			
			// Used to sign out of profile
			function signOut() {
				var auth2 = gapi.auth2.getAuthInstance();
				auth2.signOut().then(function() {
					if (confirm('Are you sure you want to sign out?')) {
						$(".g-signin2").css("display","block");
						$(".data").css("display","none");
					} else {
						// Does nothing
					}
				})
			}

			var input = document.querySelector('input');
			var preview = document.querySelector('.preview');

			input.style.opacity = 0;input.addEventListener('change', updateImageDisplay);function updateImageDisplay() {
			while(preview.firstChild) {
				preview.removeChild(preview.firstChild);
			}

			var curFiles = input.files;
			if(curFiles.length === 0) {
				var para = document.createElement('p');
				para.textContent = 'No files currently selected for upload';
				preview.appendChild(para);
			} else {
				var list = document.createElement('ol');
				preview.appendChild(list);
				for(var i = 0; i < curFiles.length; i++) {
				var listItem = document.createElement('li');
				var para = document.createElement('p');
				if(validFileType(curFiles[i])) {
					para.textContent = 'File name ' + curFiles[i].name + ', file size ' + returnFileSize(curFiles[i].size) + '.';
					var file = document.createElement('img');
					image.src = window.URL.createObjectURL(curFiles[i]);

					listItem.appendChild(file);
					listItem.appendChild(para);

				} else {
					para.textContent = 'File name ' + curFiles[i].name + ': Not a valid file type. Update your selection.';
					listItem.appendChild(para);
				}

				list.appendChild(listItem);
				}
			}
			}var fileTypes = [
			'file/xlsx',
			'file/csv'
			]

			function validFileType(file) {
			for(var i = 0; i < fileTypes.length; i++) {
				if(file.type === fileTypes[i]) {
				return true;
				}
			}

			return false;
			}function returnFileSize(number) {
			if(number < 1024) {
				return number + 'bytes';
			} else if(number >= 1024 && number < 1048576) {
				return (number/1024).toFixed(1) + 'KB';
			} else if(number >= 1048576) {
				return (number/1048576).toFixed(1) + 'MB';
			}	
			}
		</script>
		<style>
			.g-signin2 {
				float: right;
				padding-top: 7.5px;
			}
			.data {
				display: none;
			}
            body {
                padding-top: 65px;
                padding-left: 5px;
				background-image: url('https://data-sense.herokuapp.com/static/img/what-the-hex.png');
			}
            ul.nav li.dropdown:hover ul.dropdown-menu {
                display: block;
            }
			nav {
				background-color: white;
			}
		</style>
	</head>

    <body>
        <nav class="navbar navbar-fixed-top admin-menu bg-light" role="navigation">
            <a class="navbar-brand" href="/">Data Sense</a>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <a class="navbar-brand" href="/about.html">About</a>
			<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1" style="padding-right:15px;">
                <ul class="nav navbar-nav navbar-right">
					<li>
						<div class="g-signin2" data-onsuccess="onSignIn" style="padding-right:5px;"></div>
					</li>
					<li class="data" style="padding-top:7.5px;">
						<h5 class="text-primary" id="name" style="padding-right: 5px;"></h5>
					</li>
                    <li class="dropdown" style="padding-top:7.5px;padding-right:5px;">
                        <img id="pic" class="img-circle data" width="35" height="35" />
                        <ul class="dropdown-menu">
                            <li style="float: right;">
                                <a href="/profile.html">Profile Settings</a>
                            </li>
                            <li style="float: right;">
                                <button onclick="signOut()" class="btn btn-primary">Sign Out</button>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </nav>

        <div class="data" style="background-color:white;float:left;" width="15%" height="100">
			<h5 class="text-primary" style="text-align:center;">Groups</h5>
		</div>
		<div class="data" style="background-color:white;float:left;" width="35%">
			<form method="post" enctype="multipart/form-data">
				<div class="panel panel-primary">
					<div class="panel-heading"><label for="file_uploads">Choose a .xlsx or .csv file to upload</label></div>
					<div class="panel-body"><input type="file" id="file_uploads" name="file_uploads" accept=".xlsx, .csv" multiple></div>
					<div><button class="btn btn-primary" style="padding-top:5px;">Upload</button></div>
				</div>
			</form>
			
            <h3>Here are your files</h3>
            {% for key, value in result.items() %}
            <p> {{ value }} </p>
            {% endfor %}
            <h3>End</h3>
		</div>
    </body>
</html>