<!DOCTYPE html>

<html>
	<head>
		<title>Data Sense</title>
		<!--<meta charset="utf-8" />-->
		<meta name="google-signin-client_id" content="798265448710-nqo7h881abf59cn9oghng9erq841tbq1.apps.googleusercontent.com">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<script src="https://apis.google.com/js/platform.js" async defer></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<link rel="icon" href="{{url_for('static', filename='img/ds_logo.png')}}">
		<script type=text/javascript>

			// When the user clicks on div, open the popup
			function myFunction() {
				var popup = document.getElementById("myPopup");
				popup.classList.toggle("show");
			}
			
			// Used to sign in to Google Profile
			function onSignIn(googleUser) {
				var profile = googleUser.getBasicProfile();
				$(".g-signin2").css("display","none");
				$(".data").css("display","block");
				$(".goaway").css("display","none");
				$("#pic").attr('src',profile.getImageUrl());
				$.post( "/", profile.getEmail());
				$("#email").text(profile.getEmail());
				$('#name').text(profile.getName());
			}
			
			
			// Used to sign out of profile
			function signOut() {
				var auth2 = gapi.auth2.getAuthInstance();
				auth2.signOut().then(function() {
					if (confirm('Are you sure you want to sign out?')) {
						$(".g-signin2").css("display","block");
						$(".data").css("display","none");
					} else {
						// Does nothing
					}
				})
			}

			var input = document.querySelector('input');
			var preview = document.querySelector('.preview');

			input.style.opacity = 0;input.addEventListener('change', updateImageDisplay);function updateImageDisplay() {
			while(preview.firstChild) {
				preview.removeChild(preview.firstChild);
			}

			var curFiles = input.files;
			if(curFiles.length === 0) {
				var para = document.createElement('p');
				para.textContent = 'No files currently selected for upload';
				preview.appendChild(para);
			} else {
				var list = document.createElement('ol');
				preview.appendChild(list);
				for(var i = 0; i < curFiles.length; i++) {
				var listItem = document.createElement('li');
				var para = document.createElement('p');
				if(validFileType(curFiles[i])) {
					para.textContent = 'File name ' + curFiles[i].name + ', file size ' + returnFileSize(curFiles[i].size) + '.';
					var file = document.createElement('img');
					image.src = window.URL.createObjectURL(curFiles[i]);

					listItem.appendChild(file);
					listItem.appendChild(para);

				} else {
					para.textContent = 'File name ' + curFiles[i].name + ': Not a valid file type. Update your selection.';
					listItem.appendChild(para);
				}

				list.appendChild(listItem);
				}
			}
			}var fileTypes = [
			'file/xlsx',
			'file/csv'
			]

			function validFileType(file) {
			for(var i = 0; i < fileTypes.length; i++) {
				if(file.type === fileTypes[i]) {
				return true;
				}
			}

			return false;
			}function returnFileSize(number) {
			if(number < 1024) {
				return number + 'bytes';
			} else if(number >= 1024 && number < 1048576) {
				return (number/1024).toFixed(1) + 'KB';
			} else if(number >= 1048576) {
				return (number/1048576).toFixed(1) + 'MB';
			}	
			}

			function on() {
				document.getElementById("overlay").style.display = "block";
			}

			function off() {
				document.getElementById("overlay").style.display = "none";
			}
		</script>
		<style>
			.g-signin2 {
				float: right;
				padding-top: 7.5px;
			}
			.data {
				display: none;
			}
			.goaway {
				display: block;
				padding-top: 50px;
				text-align: center;
			}
            body {
                padding-top: 65px;
                padding-left: 5px;
			}
            ul.nav li.dropdown:hover ul.dropdown-menu {
                display: block;
            }
			nav {
				background-color: white;
			}
			
			#overlay {
				display: none;
				width: 100;
				text-align: center;
			}
		</style>
	</head>

    <body>
        <nav class="navbar navbar-fixed-top admin-menu bg-light" role="navigation">
            <a class="navbar-brand" href="/">Data Sense</a>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <a class="navbar-brand" href="/about">About</a>
			<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1" style="padding-right:15px;">
                <ul class="nav navbar-nav navbar-right">
					<li class="dropdown data" style="padding-top:7.5px;padding-right:5px;">
                        <img src="{{url_for('static', filename='img/new_blue.png')}}" style="float:right" width="37.5" height="37.5" />
                        <ul class="dropdown-menu" style="text-align:center;">
                            <li>
								<p class="text-primary">Notifications</p>
							</li>
                        </ul>
                    </li>
					<li>
						<div class="g-signin2" data-onsuccess="onSignIn" style="padding-right:5px;"></div>
					</li>
					<li class="dropdown data" style="padding-top:7.5px;padding-right:5px;">
						<h5 class="text-primary" id="name" style="padding-right:5px;float:left;"></h5>
                        <img id="pic" class="img-circle data" style="float:right" width="37.5" height="37.5" />
                        <ul class="dropdown-menu" style="text-align:center;">
                            <li>
                                <a class="text-primary" href="/profile">Profile Settings</a>
                            </li>
                            <li>
                                <button onclick="signOut()" class="btn btn-primary">Sign Out</button>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
		</nav>
		
		<div class="goaway">
			<h3>Welcome to Data Sense!</h3>
			<h5>Please Sign In</h5>
			<img src="{{url_for('static', filename='img/ds_logo.png')}}" width="200" height="200"/>
		</div>

        <div class="data" style="background-color:white;float:left;" width="15%">
			<h3 class="text-primary" style="text-align:center;">Groups</h3>
			<ul>

			</ul>
			<div style="text-align:center;">
				<a class="text-primary" onclick="on()">Form a Group</a>
			</div>

			<div id="overlay">
					<form>
						<h4 class="text-primary">Form a Group!</h4>
						<img class="img-circle" src="{{url_for('static', filename='img/makegroup.png')}}" width="50" height="50">
						<input class="form-control" type="text" placeholder="Group Name" width="15%">
						<a class="text-primary">Add members</a>
						<button class="btn btn-primary">Assemble the Group!</button>
						<a class="text-primary" onclick="off()">Cancel</a>
					</form>
				</div>
		</div>
		<div class="data" style="background-color:white;float:right;padding-right:5px;" width="35%">
			<form method="post" enctype="multipart/form-data">
				<div class="panel panel-primary">
					<div class="panel-heading"><label for="file_uploads">Choose a .xlsx or .csv file to upload</label></div>
					<div class="panel-body"><input type="file" id="file_uploads" name="file_uploads" accept=".xlsx, .csv" multiple></div>
					<div><button class="btn btn-primary" style="padding-top:5px;">Upload</button></div>
				</div>
			</form>
			
            <h3>Here are your files</h3>
            {% for key, value in result.items() %}
            <p> {{ value }} </p>
            {% endfor %}
            <h3>End</h3>
		</div>
    </body>
</html>